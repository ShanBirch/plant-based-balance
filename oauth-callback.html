<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Returning to Balance...</title>
    <style>
        body {
            background: #f8fafc;
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
            font-family: 'Inter', -apple-system, sans-serif;
            text-align: center;
        }
        .container {
            max-width: 360px;
        }
        .spinner {
            width: 48px;
            height: 48px;
            border: 4px solid #e2e8f0;
            border-top: 4px solid #48864B;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
            margin: 0 auto 24px;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        h2 {
            color: #1a4d2e;
            font-size: 1.25rem;
            margin-bottom: 8px;
        }
        p {
            color: #64748b;
            font-size: 0.9rem;
            margin-bottom: 24px;
        }
        .fallback {
            display: none;
        }
        .fallback a {
            display: inline-block;
            background: #48864B;
            color: white;
            text-decoration: none;
            padding: 14px 32px;
            border-radius: 12px;
            font-weight: 700;
            font-size: 1rem;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="spinner"></div>
        <h2>Returning to Balance...</h2>
        <p>You'll be redirected back to the app automatically.</p>
        <div class="fallback" id="fallback">
            <p>Didn't redirect? Tap the button below.</p>
            <a id="app-link" href="#">Open Balance App</a>
        </div>
    </div>

    <script>
        // Supabase OAuth redirects here with tokens in the URL hash fragment:
        //   /oauth-callback.html#access_token=...&refresh_token=...&...
        //
        // We pass the entire fragment through to the app via the custom URL
        // scheme so Android's intent filter opens the native app.
        var hash = window.location.hash.substring(1); // strip leading '#'

        if (hash && hash.indexOf('access_token') !== -1) {
            var appUrl = 'com.fitgotchi.app://login-callback#' + hash;

            // Set the fallback link in case auto-redirect doesn't fire
            var link = document.getElementById('app-link');
            if (link) link.href = appUrl;

            // Try to open the app immediately
            window.location.href = appUrl;

            // If still here after 2.5 seconds, show the manual button
            setTimeout(function() {
                var fb = document.getElementById('fallback');
                if (fb) fb.style.display = 'block';
            }, 2500);
        } else {
            // No tokens in the hash â€” shouldn't happen in normal flow.
            // Redirect to login page.
            window.location.replace('/login.html');
        }
    </script>
</body>
</html>
